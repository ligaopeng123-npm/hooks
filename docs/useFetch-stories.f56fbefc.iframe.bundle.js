"use strict";(self.webpackChunk_gaopeng123_hooks=self.webpackChunk_gaopeng123_hooks||[]).push([[959],{"./stories/useFetch.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__namedExportsOrder:()=>__namedExportsOrder,default:()=>useFetch_stories,demo:()=>demo});var react=__webpack_require__("./node_modules/.pnpm/react@17.0.2/node_modules/react/index.js"),dist=__webpack_require__("./packages/useFetch/dist/index.js"),jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@17.0.2/node_modules/react/jsx-runtime.js");const itemStyle={padding:"0 16px"},TestUseFetch=props=>{const[dep1,setDep1]=(0,react.useState)(1),[dep2,setDep2]=(0,react.useState)(2),[loading,error,data]=(0,dist.useGet)("/assets/test.json",{},(res=>res.data),[dep1]),[loading1,error1,data1]=(0,dist.useUpdateGet)("/assets/test.json",{params:{dep:dep2}},(res=>res.data)),[loading2,error2,data2,{run}]=(0,dist.useCtrlGet)("/assets/test.json",{},(res=>res.data)),[{sent,abort}]=(0,dist.useGetFetch)();return loading?(0,jsx_runtime.jsx)("span",{children:"loading"}):error?(0,jsx_runtime.jsx)("span",{children:error}):(0,jsx_runtime.jsxs)(react.Fragment,{children:[(0,jsx_runtime.jsx)("h3",{onClick:()=>{setDep1(Math.random())},children:"useGet"}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",width:500},children:[(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["loading: ",loading]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["error: ",error]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["data: ",JSON.stringify(data,null,2)]})]}),(0,jsx_runtime.jsx)("h3",{onClick:()=>{sent("/assets/test.json").then((res=>{console.log(res)})),setTimeout((()=>{}),1)},children:"useGetFetch"}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",width:500},children:[(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["loading: ",loading]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["error: ",error]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["data: ",JSON.stringify(data,null,2)]})]}),(0,jsx_runtime.jsx)("h3",{onClick:()=>{setDep2(Math.random()),setTimeout((()=>{setDep2(Math.random())}),5)},children:"useUpdateGet"}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",width:500},children:[(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["loading: ",loading1]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["error: ",error1]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["data: ",JSON.stringify(data1,null,2)]})]}),(0,jsx_runtime.jsx)("h3",{onClick:run,children:"useCtrlGet"}),(0,jsx_runtime.jsxs)("div",{style:{display:"flex",width:500},children:[(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["loading: ",loading2]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["error: ",error2]}),(0,jsx_runtime.jsxs)("div",{style:itemStyle,children:["data: ",JSON.stringify(data2,null,2)]})]})]})};TestUseFetch.displayName="TestUseFetch";const components_TestUseFetch=TestUseFetch;try{TestUseFetch.displayName="TestUseFetch",TestUseFetch.__docgenInfo={description:"",displayName:"TestUseFetch",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["example/components/TestUseFetch.tsx#TestUseFetch"]={docgenInfo:TestUseFetch.__docgenInfo,name:"TestUseFetch",path:"example/components/TestUseFetch.tsx#TestUseFetch"})}catch(__react_docgen_typescript_loader_error){}var blocks_dist=__webpack_require__("./node_modules/.pnpm/@storybook+blocks@7.4.2_74b3ggvk3akyhuq4eydyx3fqim/node_modules/@storybook/blocks/dist/index.mjs");const useFetch_stories={title:"Example/useFetch",component:(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{}),parameters:{layout:"centered",docs:{page:()=>(0,jsx_runtime.jsx)(jsx_runtime.Fragment,{children:(0,jsx_runtime.jsx)(blocks_dist.UG,{children:"# useFetch\n\n>注意：如果和@gaopeng123/fetch一起使用，共享拦截器注入的header属性，需要使用initCreateFetch方法把createFeatch函数注入下\n>\n>[在线demo](https://ligaopeng123-npm.github.io/hooks/?path=/story/example-usefetch--demo)\n\n## initCreateFetch\n\n```tsx\nexport { get, post, put, del, patch, createFetch } from \"@gaopeng123/fetch\";\ninitCreateFetch(createFetch);\n```\n\n## 参数\n\n`(url: string, options: Options, checkResponse?: CheckResponse, deps: Array<any>) : [loading, error, data];`\n\n```typescript\ntype Method = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';\ntype Options = {\n    method: Method,\n    body?: any; // post请求 参数放在body上\n    params?: any; // get请求 参数拼接在url上\n    responseType?: 'text' | 'json' | 'blob' | 'formData' | 'arrayBuffer';\n    noModification?: boolean, // 是否要根据responseType做数据获取\n    abortController?: AbortController, // 控制fetch abort\n    headers?: {\n        token?: string;\n        [propName: string]: any;\n    };\n}\n\ntype CheckResponse = (props: any) => any;\n\ntype Deps = any[];\n```\n\n## Usage\n\n```tsx\nimport {useGet, usePost, useDel, usePut, usePatch} from \"@gaopeng123/hooks.use-fetch\";\n\nconst TestUseFetch: React.FC<TestUseFetchProps> = (props) => {\n     const [dep1, setDep1] = useState(1);\n    const [dep2, setDep2] = useState(2);\n    const [loading, error, data] = useGet('/assets/test.json', {}, (res) => {\n        return res.data;\n    }, [dep1, dep2]);\n\n    const onClick = () => {\n        setDep1(Math.random())\n    }\n\n    if (loading) {\n        return (<span>loading</span>)\n    }\n\n    if (error) {\n        return (<span>{error}</span>)\n    }\n\n    return (\n        <React.Fragment>\n            <h3 onClick={onClick}>useGet</h3>\n            <div style={{display: 'flex', width: 500}}>\n                <div style={itemStyle}>loading: {loading}</div>\n                <div style={itemStyle}>error: {error}</div>\n                <div style={itemStyle}>data: {JSON.stringify(data, null, 2)}</div>\n            </div>\n            <h3>usePost</h3>\n            <h3>useDel</h3>\n            <h3>usePut</h3>\n            <h3>usePatch</h3>\n        </React.Fragment>\n    )\n};\n\nexport default TestUseFetch;\n```\n\n## useCreateFetch\n\n`创建一个可操作的fetch`\n\n```tsx\nimport {useGetFetch, usePostFetch, useDelFetch, usePutFetch, usePatchFetch} from \"@gaopeng123/hooks.use-fetch\";\n\nconst TestUseFetch: React.FC<TestUseFetchProps> = (props) => {\n const [{\n        sent,\n        abort\n    }] = useGetFetch();\n  \n  \n  return (\n        <React.Fragment>\n            <h3 onClick={() => {\n                sent('/assets/test.json').then(res => {\n                    console.log(res);\n                });\n                setTimeout(() => {\n                    abort();\n                }, 1)\n            }\n            }>useGetFetch</h3>\n        </React.Fragment>\n    )\n}\n\n\n\n```\n\n\n\n## useUpdateFetch\n\n`初始化时不下发，只有当依赖参数变更后才会下发`\n\n```tsx\n// 初次opts赋值时不加载，当opts再次赋值时接口调用；会自动处理接口abort\nconst [opts, setOpts] = useState({});\nuseEffect(()=> {}, [\n  setTimeout(()=> {\n    setOpts({params: {name: 'name'}});\n  }, 5000);\n]);\nconst [loading, error, data] = useUpdateGet('/assets/test.json', opts}, (res) => {\n        return res.data;\n    });\n```\n\n## useCtrlFetch\n\n`初次不加载，只有当依赖参数变更后才会触发查询`\n\n```tsx\n// 初次不加载，当run()时触发接口调用；会自动处理接口abort\nconst [opts, setOpts] = useState({});\nuseEffect(()=> {}, [\n  setTimeout(()=> {\n    run();\n  }, 5000);\n]);\nconst [loading, error, data, {run}] = useCtrlGet('/assets/test.json', opts}, (res) => {\n        return res.data;\n    });\n```\n\n"})})}},tags:["autodocs"],argTypes:{}},demo={args:{},render:()=>(0,jsx_runtime.jsx)(components_TestUseFetch,{})};demo.parameters={...demo.parameters,docs:{...demo.parameters?.docs,source:{originalSource:"{\n  args: {},\n  render: () => {\n    return <TestUseFetch />;\n  }\n}",...demo.parameters?.docs?.source}}};const __namedExportsOrder=["demo"]},"./packages/useFetch/dist/hooks.use-fetch.cjs.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{var t=__webpack_require__("./node_modules/.pnpm/react@17.0.2/node_modules/react/index.js"),e=__webpack_require__("./node_modules/.pnpm/@gaopeng123+fetch@0.3.4/node_modules/@gaopeng123/fetch/dist/fetch.esm.js"),n=__webpack_require__("./node_modules/.pnpm/@gaopeng123+utils.types@1.1.12-alpha.2/node_modules/@gaopeng123/utils.types/dist/utils.types.esm.js");function r(){return(r=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var u,o=e.createFetch;!function(t){t.ctrl="ctrl",t.update="update",t.auto="auto"}(u||(u={}));var s=function(r,u,s,c){var i=t.useState(),a=i[0],h=i[1],f=t.useState(""),d=f[0],p=f[1],l=t.useState(!0),g=l[0],m=l[1],b=t.useState(!1),E=b[0],x=b[1],M=t.useState(),O=M[0],j=M[1],v=t.useState(u),C=v[0],P=v[1],F=function(){var t=u.abortController||new AbortController;return o(r,Object.assign({method:e.MethodEnum.get,abortController:t},u)).then((function(t){m(!1),h(s&&n.isFunction(s)?s(t):t)})).catch((function(t){m(!1),p(null==t?void 0:t.toString())})),function(){null==t||t.abort()}},S=function(){return"update"===u.trigger?E?F():(x(!0),function(){}):"ctrl"===u.trigger?O?F():function(){}:F()};return t.useEffect((function(){return S()}),[O]),t.useEffect((function(){return S()}),[C]),t.useEffect((function(){JSON.stringify(C)!==JSON.stringify(u)&&P(u)}),[u]),t.useEffect((function(){return S()}),c||[]),[g,d,a,{run:function(){j(Date.now())}}]},c=function(t,e,n,o){return s(t,r({trigger:u.ctrl},e),n,o)},i=function(t,e,n,o){var c=s(t,r({trigger:u.update},e),n,o);return[c[0],c[1],c[2]]},a=function(n){var r=t.useRef({}),u=function(){var t;r.current.abortController&&(null==(t=r.current.abortController)||t.abort())};return t.useEffect((function(){return function(){u()}}),[]),[{sent:function(t,s){u();var c=new AbortController;return r.current.abortController=c,o(t,Object.assign({method:n||e.MethodEnum.get,abortController:c},s))},abort:u}]};exports.useCtrlGet=function(t,n,r,u){return c(t,Object.assign({method:e.MethodEnum.get},n),r,u)},exports.useGet=function(t,n,r,u){var o=s(t,Object.assign({method:e.MethodEnum.get},n),r,u);return[o[0],o[1],o[2]]},exports.useGetFetch=function(){return a(e.MethodEnum.get)},exports.useUpdateGet=function(t,n,u,o){return i(t,r({method:e.MethodEnum.get},n),u,o)}},"./packages/useFetch/dist/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{module.exports=__webpack_require__("./packages/useFetch/dist/hooks.use-fetch.cjs.production.min.js")}}]);